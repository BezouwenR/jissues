{% extends 'index.twig' %}

{% block title %}
    {{ parent() }} | {{ item.article_id ? 'Edit Article' : 'New Article' }}
{% endblock %}

{% block headerCSS %}
    {{ parent() }}

    <link rel="stylesheet" href="{{ asset('css/markitup/skins/tracker/style.css') }}" />
    <link rel="stylesheet" href="{{ asset('css/markitup/sets/markdown/style.css', 'debug') }}" />
{% endblock %}

{% block prependMenu %}
    <li>
        <a class="btn-success" href="javascript:;" onclick="document.editForm.submit();">Save</a>
    </li>
    <li>
        <a class="btn-inverse" href="{{ uri.base.path }}text">Cancel</a>
    </li>
    {{ parent() }}
{% endblock %}

{% block content %}
    <div class="page-header">
        <h1>{{ item.article_id ? 'Edit Article' : 'New Article' }}</h1>
    </div>

    <form method="post" action="{{ uri.base.path }}text/save" class="form-horizontal" name="editForm">
        <div>
            <fieldset>
                <div class="control-group">
                    <label class="control-label" for="title">Title</label>
                    <div class="controls">
                        <input type="text" name="article[title]" id="title" value="{{ item.title }}" />
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for="alias">Alias</label>
                    <div class="controls">
                        <input type="text" name="article[alias]" id="alias" value="{{ item.alias }}" />
                    </div>
                </div>
            </fieldset>

           {% include 'editor.twig' with {'editorId': 'text', 'writeId': 'write', 'previewId': 'preview', 'editorName': 'article[text_md]', 'editorPlaceholder': 'Article Text', 'editorText': item.text_md} %}

            <input type="hidden" name="article[article_id]" value="{{ item.article_id }}"/>
        </div>
    </form>
{% endblock %}

{% block JavaScriptBottom %}
    {{ parent() }}

    <script src="{{ asset('markitup/jquery.markitup.js') }}"></script>
    <script src="{{ asset('css/markitup/sets/markdown/set.js') }}"></script>

    <script type="text/javascript">
        $('#text').markItUp(myMarkdownSettings);

        $('a[data-toggle="tab"]').on('shown', function (e) {
            if('#preview' == $(e.target).attr('href')) {
                JTracker.preview('#text', '#preview', '#preview');
            }
        });
    </script>
{% endblock %}
