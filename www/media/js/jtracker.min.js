!function(e,c){"use strict";e.JTracker={preview:function(e,t){var s=c(t);s.html(g11n3t("Loading preview...")),c.post("/preview",{text:c(e).val()},function(e){s.empty(),e.error?s.html(e.error):e.data.length?s.html(e.data):s.html(g11n3t("Invalid response."))})},submitComment:function(e,t,s,a,r){var l=c(s),n=c(t),i=c(r).val();n.html(g11n3t("Submitting comment...")),c.post("/submit/comment",{text:c("#comment").val(),issue_number:e,sha:i},function(e){if(e.data)if(e.error)n.html(e.error);else{n.html(e.message),l.html(l.html()+tmpl(a,e.data)),c("#comment").val(""),c("tbody.files").empty(),0<c("input[name=comment-tested]").filter(":checked").val()&&JTracker.submitTestWithComment(l,"tplNewTestResult")}else n.html(g11n3t("Invalid response."))})},submitVote:function(e,t){var s=c(t),a=c("input[name=importanceRadios]").filter(":checked").val(),r=c("input[name=experiencedRadios]").filter(":checked").val();s.addClass("disabled").removeAttr("href").removeAttr("onclick").html(g11n3t("Adding vote...")),c.post("/submit/vote",{issueId:e,experienced:r,importance:a},function(e){e.error?s.addClass("btn-danger").removeClass("btn-success").html(e.error):(s.html(e.message),0<e.data.votes&&(c("div[id=experienced]").html(e.data.experienced+"/"+e.data.votes),c("div[id=importance]").html(e.data.importanceScore.toFixed(2)),c("div#issue-votes").show()))})},submitTest:function(e,t,s,a,r,l){var n=c(t),i=c(s),o=c("input[name=tested]").filter(":checked").val(),u=c(a).val(),m=c(r).val();n.html(g11n3t("Submitting test result...")),c.post("/submit/testresult",{issueId:e,result:o,comment:u,sha:m},function(e){if(e.error)n.addClass("btn-danger").removeClass("btn-success").html(e.error);else{n.addClass("text-success").html(e.message);var t=c.parseJSON(e.data);JTracker.updateTests(t.testResults.testsSuccess,t.testResults.testsFailure),i.html(i.html()+tmpl(l,t.event)),c("#current-test-result").val(o),c(".comment-test-result").prop("checked",!1),c("#comment-test-result-"+o).prop("checked",!0),c("#testContainer").delay(1e3).slideUp()}})},submitTestWithComment:function(s,a){var e=c("#issue-id").val(),r=c("input[name=comment-tested]").filter(":checked").val(),t=c("#current-test-result").val();r&&t!=r&&c.post("/submit/testresult",{issueId:e,result:r},function(e){if(e.error)s.html(e.error);else{c(".test-result").prop("checked",!1),c("#test-result-"+r).prop("checked",!0),c(".comment-test-result").prop("checked",!1),c("#comment-test-result-"+r).prop("checked",!0),c("#current-test-result").val(r);var t=c.parseJSON(e.data);JTracker.updateTests(t.testResults.testsSuccess,t.testResults.testsFailure),s.html(s.html()+tmpl(a,t.event)),c("#testContainer").delay(1e3).slideUp()}})},alterTest:function(e,t,s,a,r){var l=c(t),n=c(s),i=c(a).val(),o=c("select[name=altered]").val(),u=c("input[name=altered-user]").val();""!=u?(l.html(g11n3t("Submitting test result...")),c.post("/alter/testresult",{issueId:e,user:u,result:o,sha:i},function(e){if(e.error)l.addClass("btn-danger").removeClass("btn-success").html(e.error);else{l.addClass("text-success").html(e.message);var t=c.parseJSON(e.data);JTracker.updateTests(t.testResults.testsSuccess,t.testResults.testsFailure),n.html(n.html()+tmpl(r,t.event))}})):l.html(g11n3t("Please select a user"))},updateTests:function(e,t){c("#usertests-success-num").text(e.length),c("#usertests-success").text(e.join(", ")),c("#usertests-fail-num").text(t.length),c("#usertests-fail").text(t.join(", "))},getContrastColor:function(e){return 128<=(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3?"black":"white"},setupAtJS:function(e,t){var s={at:":",data:c.map(["smile","iphone","girl","smiley","heart","kiss","copyright","coffee","a","ab","airplane","alien","ambulance","angel","anger","angry","arrow_forward","arrow_left","arrow_lower_left","arrow_lower_right","arrow_right","arrow_up","arrow_upper_left","arrow_upper_right","art","astonished","atm","b","baby","baby_chick","baby_symbol","balloon","bamboo","bank","barber","baseball","basketball","bath","bear","beer","beers","beginner","bell","bento","bike","bikini","bird","birthday","blue_car","blue_heart","blush","boar","boat","bomb","book","boot","bouquet","bow","bowtie","boy","bread","briefcase","broken_heart","bug","bulb","person_with_blond_hair","phone","pig","pill","pisces","point_down","point_left","point_right","point_up","point_up_2","police_car","poop","post_office","postbox","pray","princess","punch","purple_heart","question","rabbit","racehorse","radio","up","us","v","vhs","vibration_mode","virgo","vs","walking","warning","watermelon","wave","wc","wedding","whale","wheelchair","wind_chime","wink","wolf","woman","womans_hat","womens","x","yellow_heart","zap","zzz","+1","-1","tongue"],function(e,t){return{key:e,name:e}}),displayTpl:"<li data-value=':${key}:'><img src='https://assets-cdn.github.com/images/icons/emoji/${key}.png' height='20' width='20' /> ${name}</li>",insertTpl:":${name}:"},a={at:"@",searchKey:"username",callbacks:{remoteFilter:function(e,t){c.getJSON("/fetch/users",{q:e},function(e){t(e.data)})}},displayTpl:"<li data-value='@${username}'><img src='/images/avatars/${username}.png' height='20' width='20'> ${username} <small>${name}</small></li>",insertTpl:"@${username}"},r={at:"#",searchKey:"issue_number",callbacks:{remoteFilter:function(e,t){c.getJSON("/fetch/issues",{q:e},function(e){t(e.data)})}},displayTpl:"<li data-value='#${issue_number}'>${issue_number} <small>${title}</small></li>",insertTpl:"#${issue_number}"};c("#"+e).atwho(s).atwho(a).atwho(r)}}}(window,jQuery);